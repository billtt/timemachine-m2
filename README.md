# TimeMachine 2.0

> This project is mostly generated by Claude Code.

A modern rewrite of the TimeMachine personal life tracking application using the latest web technologies.

## Features

- **Modern Tech Stack**: React 18, TypeScript, Vite, Tailwind CSS
- **Progressive Web App (PWA)**: Installable on mobile devices
- **Offline Support**: Create slices offline, sync when online
- **Real-time Sync**: Background synchronization of offline data
- **Responsive Design**: Works seamlessly on desktop and mobile
- **Dark Mode**: Toggle between light and dark themes
- **Privacy Mode**: Quickly hide sensitive content (press Q)
- **Search**: Full-text search with regex support
- **Authentication**: JWT-based secure authentication
- **Modern UI**: Clean, intuitive interface with animations

## Tech Stack

### Backend
- **Node.js + Express**: Web framework
- **TypeScript**: Type safety
- **MongoDB + Mongoose**: Database and ODM
- **JWT**: Authentication
- **bcrypt**: Password hashing
- **Zod**: Runtime validation
- **Express Rate Limit**: API protection

### Frontend
- **React 18**: UI framework
- **TypeScript**: Type safety
- **Vite**: Build tool
- **Tailwind CSS**: Styling
- **React Router**: Navigation
- **React Query**: Data fetching
- **Zustand**: State management
- **React Hook Form**: Form handling
- **IndexedDB**: Offline storage
- **Service Workers**: PWA functionality

## Project Structure

```
time.new/
├── server/                 # Backend application
│   ├── src/
│   │   ├── controllers/    # Route handlers
│   │   ├── middleware/     # Express middleware
│   │   ├── models/         # Database models
│   │   ├── routes/         # API routes
│   │   ├── services/       # Business logic
│   │   ├── types/          # TypeScript types
│   │   ├── utils/          # Utility functions
│   │   └── app.ts          # Express app setup
│   └── package.json
├── client/                 # Frontend application
│   ├── src/
│   │   ├── components/     # React components
│   │   ├── pages/          # Page components
│   │   ├── services/       # API and offline services
│   │   ├── store/          # State management
│   │   ├── types/          # TypeScript types
│   │   └── App.tsx         # Main app component
│   └── package.json
├── shared/                 # Shared types and utilities
└── package.json            # Root package.json
```

## Quick Start

### Prerequisites
- Node.js 18+
- MongoDB
- npm or yarn

### Installation

1. **Install dependencies**:
   ```bash
   npm run install:all
   ```

2. **Set up environment variables**:
   ```bash
   # Copy server environment file
   cp server/.env.example server/.env
   
   # Edit server/.env with your configuration
   ```

3. **Start development servers**:
   ```bash
   npm run dev
   ```

   This starts both the backend (port 5000) and frontend (port 3000) in development mode.

4. **Access the application**:
   - Frontend: http://localhost:3000
   - Backend API: http://localhost:5000

### Production Build

```bash
npm run build
npm start
```

## Environment Variables

### Server (.env)
```env
PORT=5000
NODE_ENV=development
MONGODB_URI=mongodb://127.0.0.1:27017/timemachine
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=7d
BCRYPT_ROUNDS=12
CORS_ORIGIN=http://localhost:3000
```

### Client (Optional)
```env
VITE_API_URL=http://localhost:5000/api
```

## API Endpoints

### Authentication
- `POST /api/auth/register` - Register new user
- `POST /api/auth/login` - Login user
- `GET /api/auth/profile` - Get user profile
- `PUT /api/auth/profile` - Update profile
- `PUT /api/auth/password` - Change password

### Slices
- `GET /api/slices` - Get slices with filters
- `POST /api/slices` - Create new slice
- `GET /api/slices/:id` - Get specific slice
- `PUT /api/slices/:id` - Update slice
- `DELETE /api/slices/:id` - Delete slice
- `GET /api/slices/search` - Search slices
- `GET /api/slices/stats` - Get statistics

### Sync (PWA)
- `POST /api/sync` - Sync offline slices
- `GET /api/sync/last-sync` - Get last sync time
- `GET /api/sync/since` - Get slices since timestamp

## PWA Features

### Installation
- App can be installed on mobile devices
- Add to home screen prompt
- Standalone app experience

### Offline Functionality
- Create slices offline
- Automatic sync when online
- Cached data for offline viewing
- Background sync support

### Service Worker
- Caches app shell and assets
- Handles offline scenarios
- Background sync for pending data

## Database Migration

The new version is compatible with the existing MongoDB database. The data structure remains the same:

- **Users collection**: `{ name, key, token, createdAt, updatedAt }`
- **Slices collection**: `{ user, content, type, time, createdAt, updatedAt }`

## Development

### Available Scripts

```bash
# Install all dependencies
npm run install:all

# Start development (both server and client)
npm run dev

# Build for production
npm run build

# Start production server
npm start

# Run tests
npm test

# Lint code
npm run lint

# Type checking
npm run typecheck
```

### Code Quality
- ESLint for linting
- Prettier for formatting
- TypeScript for type safety
- Comprehensive error handling

## Deployment

### Docker (Recommended)
```bash
# Build and run with Docker Compose
docker-compose up -d
```

### Manual Deployment
1. Build the application: `npm run build`
2. Set up MongoDB
3. Configure environment variables
4. Start the server: `npm start`
5. Set up reverse proxy (nginx/apache)

### PM2 Process Manager
```bash
# Install PM2
npm install -g pm2

# Start with PM2
pm2 start ecosystem.config.js

# Monitor
pm2 monit
```

## Security Features

- JWT authentication
- Password hashing with bcrypt
- Rate limiting
- CORS protection
- Input validation
- SQL injection protection (NoSQL)
- XSS protection

## Browser Support

- Chrome/Chromium 80+
- Firefox 75+
- Safari 14+
- Edge 80+
- Mobile browsers (iOS Safari, Chrome Mobile)

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## License

MIT License - see LICENSE file for details

## Changelog

### v2.0.0
- Complete rewrite with modern tech stack
- PWA support with offline functionality
- Improved UI/UX with Tailwind CSS
- TypeScript for better type safety
- Enhanced security with JWT
- Real-time sync capabilities
- Responsive design
- Dark mode support
- Privacy mode feature

### Migration from v1.0
- Database schema remains compatible
- All existing features preserved
- Enhanced with modern capabilities
- Better performance and security